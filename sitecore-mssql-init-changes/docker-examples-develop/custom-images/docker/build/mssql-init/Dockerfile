# escape=`

ARG BASE_IMAGE

FROM ${BASE_IMAGE}

COPY .\StartInit.ps1 c:\StartInit.ps1
COPY .\SetSitecoreAdminPassword.ps1 c:\SetSitecoreAdminPassword.ps1
COPY .\InstallShards.ps1 c:\InstallShards.ps1
COPY .\DeployDatabases.ps1 c:\DeployDatabases.ps1
COPY .\databases.json c:\resources\databases.json
ENTRYPOINT .\StartInit.ps1 -ResourcesDirectory $env:RESOURCES_PATH -SqlServer $env:SQL_SERVER -SqlAdminUser $env:SQL_ADMIN_LOGIN -SqlAdminPassword $env:SQL_ADMIN_PASSWORD -SitecoreAdminPassword $env:sitecore_admin_password -SqlElasticPoolName $env:SQL_ELASTIC_POOL_NAME -DatabasesToDeploy $env:DATABASES_TO_DEPLOY -PostDeploymentWaitPeriod $env:POST_DEPLOYMENT_WAIT_PERIOD     -DatabaseUsers @(     @{'databaseName' = 'DEV.Sitecore.Master'; 'username' = $env:Master_Database_Username; 'password' = $env:Master_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Core'; 'username' = $env:Core_Database_Username; 'password' = $env:Core_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Web'; 'username' = $env:Web_Database_Username; 'password' = $env:Web_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Experienceforms'; 'username' = $env:Forms_Database_Username; 'password' = $env:Forms_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Exm.master'; 'username' = $env:Exm_Master_Database_Username; 'password' = $env:Exm_Master_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Marketingautomation'; 'username' = $env:Marketing_Automation_Database_Username; 'password' = $env:Marketing_Automation_Database_Password},     @{'databaseName' = 'DEV.Sitecore.Messaging'; 'username' = $env:Messaging_Database_Username; 'password' = $env:Messaging_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Reporting'; 'username' = $env:Reporting_Database_Username; 'password' = $env:Reporting_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Referencedata'; 'username' = $env:Reference_Data_Database_Username; 'password' = $env:Reference_Data_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Processing.Pools'; 'username' = $env:Processing_Pools_Database_Username; 'password' = $env:Processing_Pools_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Processing.Tasks'; 'username' = $env:Processing_Tasks_Database_Username; 'password' = $env:Processing_Tasks_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Processing.Engine.Tasks'; 'username' = $env:Processing_Engine_Tasks_Database_Username; 'password' = $env:Processing_Engine_Tasks_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Processing.Engine.Storage'; 'username' = $env:Processing_Engine_Storage_Database_Username; 'password' = $env:Processing_Engine_Storage_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Xdb.Collection.ShardMapManager'; 'username' = $env:Collection_ShardMapManager_Database_Username; 'password' = $env:Collection_ShardMapManager_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Xdb.Collection.Shard0'; 'username' = $env:Collection_ShardMapManager_Database_Username; 'password' = $env:Collection_ShardMapManager_Database_Password },     @{'databaseName' = 'DEV.Sitecore.Xdb.Collection.Shard1'; 'username' = $env:Collection_ShardMapManager_Database_Username; 'password' = $env:Collection_ShardMapManager_Database_Password }     )